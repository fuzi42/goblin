<!DOCTYPE html>
<html lang="en" style="width:100%;height:100%">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="./css/style.css" />
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="./js/doT.js"></script>
    <title>哥?布:零-作品展示</title>
</head>
<body style="width: 100%;height: auto;margin: 0;padding: 0;overflow-x: hidden;">
    <!-- 发布作品模块 -->
    <div style="position: fixed;right: 0;bottom: 20%;"><button style="padding: 5px 20px;border-radius: 80% 50%;cursor: pointer;color: white;z-index: 100;" data-toggle="modal" data-target="#send" onclick="image()">发布图片</button></div>
    <div style="position: fixed;right: 0;bottom: 10%;"><button style="padding: 5px 20px;border-radius: 80% 50%;cursor: pointer;color: white;z-index: 100;" data-toggle="modal" data-target="#send" onclick="video()">发布视频</button></div>
    <!-- <div style="position: absolute;left: 0;top: 0;color: white;"><a href="/index.html" style="color: black;z-index: 100;">返回</a></div> -->
    <!-- 标题模块 -->
    <div class="title" style="height: auto;position: absolute;left: 100px;">
        <div style="width: 340px;margin: auto;"><img src="/images/goblin.png" style="float: left;width: 150px;"><h1 style="line-height: 1.5;font-family: ziti;">作品展示</h1></div>
    </div>  
    <div style="margin-top: 300px;margin: auto;position: relative;top: 100px;left: 200px;">标语2------加油！奥利给！</div>
    <div style="margin-top: 120px;width: 100%;">
        <div id="carousel-example-generic" class="carousel slide" data-ride="carousel" style="height: 300px;margin: auto;"> 
            <!-- 轮播图片及说明文字 -->
            <div class="carousel-inner" role="listbox" style="width:100%;margin: auto;margin-left: 7px;">
              <div class="item active">
                <div style="width: 33%;float: left;margin: 0px;">
                <img src="./images/003.jpg " style="width: 100%;height:auto;float: left;margin: 0px;" alt="图片1">
                <div style="position: absolute;top: 27rem;width:30%;color: white;padding: 10px;background: #8080806b;">范：something is interesting！</div>
                </div>
                <div style="width: 33%;float: left;margin: 0px;">
                <img src="./images/005.jpg" style="width: 100%;height:auto;float: left;margin: 0px;" alt="图片2">
                <div style="position: absolute;top: 27rem;left: 33%;width: 30%;color: white;padding: 10px;background: #8080806b;">范：something is interesting！</div>
                </div>
                <div style="width: 33%;float: left;margin: 0px;">
                <img src="./images/002.jpg" style="width: 100%;height:auto;float: left;margin: 0px;" alt="图片3">
                <div style="position: absolute;top: 27rem;left:66%;width: 30%;color: white;padding: 10px;background: #8080806b;">范：something is interesting！</div>
                </div>
            </div>
              <div class="item">
                    <div style="width: 33%;float: left;margin: 0px;">
                            <img src="./images/003.jpg " style="width: 100%;height:auto;float: left;margin: 0px;" alt="图片1">
                            <div style="position: absolute;top: 27rem;width:30%;color: white;padding: 10px;background: #8080806b;">范：something is interesting！</div>
                            </div>
                            <div style="width: 33%;float: left;margin: 0px;">
                            <img src="./images/005.jpg" style="width: 100%;height:auto;float: left;margin: 0px;" alt="图片2">
                            <div style="position: absolute;top: 27rem;left: 33%;width: 30%;color: white;padding: 10px;background: #8080806b;">范：something is interesting！</div>
                            </div>
                            <div style="width: 33%;float: left;margin: 0px;">
                            <img src="./images/002.jpg" style="width: 100%;height:auto;float: left;margin: 0px;" alt="图片3">
                            <div style="position: absolute;top: 27rem;left:66%;width: 30%;color: white;padding: 10px;background: #8080806b;">范：something is interesting！</div>
                            </div>
                </div>
            </div>
    </div>

    <!-- 展示模块 -->
    <div style="width: 100%;height: 100%;margin-top: 100px;">
        <div class="content" id="testid" style="width: 90%;height: auto;margin: auto;">
               
        </div>
    </div>


<!-- 发布模块 -->
    <div class="modal fade" id="send" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                &times;
              </button>
              <img src="/images/goblin.png" alt="" style="width: 65px;float: left;"/>
              <h4 class="modal-title" id="myModalLabel">
                作品发布
              </h4>
            </div>
            <div class="modal-body">
                <div class="dropdown" >
                <input id="title" type="text" name="title" placeholder="标题" style="width: 200px;border: none;border-bottom: 1px solid;outline: none;margin:20px auto;padding:inherit"/>    
                <div class="productDrawingBox">
                    <!-- 发布图片 -->
                    <div class="productDescription image">上传图片</div>
                    <div class="productImg image">
                        <div id="uploadBox">
                        </div>
                        <div class="uploadDIv">
                            <span>+</span><input type="file" name="file" multiple id="inputs" accept="image/*" class='fileTest' multiple="multiple" />
                        </div>
                    </div>
                    <!-- 发布视频 -->
                    <div class="productDescription video">上传视频</div>
                    <div class="productImg video">
                        <div id="uploadBox">
                        </div>
                        <div class="uploadDIv">
                            <span>+</span><input type="file" name="file"  id="inputsVideo" accept="video/mp4" class='fileTest'  />
                        </div>
                    </div>
                </div>
                <textarea id="messages" rows="4" placeholder="在这里写下您的感想！" style="width: 100%;min-height: 60px;padding: 10px;resize: none;border-radius: 8px;outline: none;"></textarea>
            
            </div>
            <div class="modal-footer">
              
              <button type="button" class="btn btn-primary" onclick="sendWork()">
                发布
              </button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
    </div>
<!-- 详细内容模块 -->
    <div class="modal fade" id="xiang" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
    <div class="modal-dialog" style="width: 900px;min-height: 500px;margin: auto;">
      <div class="modal-content" >
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            &times;
          </button>
          <img src="/images/goblin.png" alt="" style="width: 65px;float: left;"/>
          <h4 class="modal-title" id="myModalLabel">
        
          </h4>
        </div>
        <div id="xiang-content">

        </div>
        <div class="modal-footer">
          
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal -->
    </div>
</body>
<!-- 获取作品数据 -->
<script>
    function image(){
       $('.video').hide();
       $('.image').show()
    }
    function video(){
        $('.image').hide();
        $('.video').show();
    }
    var textjson=[]
    var card={}
    $.ajax({
        type: "GET",
        url: "http://127.0.0.1:8000/show/card/all",
        xhrFields:{                       //带上Cookie
                withCredentials : true
        }, 
        headers:{
          "content-type":"application/json",
          
          },
        dataType: "text", //后端返回数据格式
        crossDomain:true,
        success: function (data) {
            data=JSON.parse(data)   //转成json格式
            k = 0
             for ( i in data["cards"]) {
                card={"name":data["cards"][i].name,"userimage":data["cards"][i].userimage,"user_id":data["cards"][i].user_id,"title":data["cards"][i].title,"message":data["cards"][i].message,"id":data["cards"][i].id,"images":data["cards"][i].images,"video":data["cards"][i].media,"cout":k}   
                textjson[i]=card;
                k++
            } 
        console.log(textjson)
            
        tmpltxt=doT.template(document.getElementById("useType0").innerHTML);//生成模板方法
    document.getElementById("testid").innerHTML=tmpltxt(textjson);//数据渲染
         }
    });
</script>
<!-- dot引擎模板 -->
<script type="text/x-dot-template" id="useType0">
    {{~it:value:index}}
    <div style="width: 80%;height: 1000px;margin:50px auto;border:1px solid #8080804f;padding:10px 30px">
            <div style="width: 100%;height: 100%;margin:auto;">
            <div style="float:left;width:70%">
             {{? value.video}}  
             <video src="http://127.0.0.1:8000/media/{{=value.video}}" style="width: 100%;height:500px;outline:black;background:black;margin-top:50px" controls="controls"></video> 
             {{??}}   <div id="myCarousel{{=value.id}}" class="carousel slide" style="margin-top:50px">
						<!--轮播指标-->
						<ol class="carousel-indicators">
							<li data-target="#myCarousel{{=value.id}}" data-slide-to="0" class="active"></li>
							<li data-target="#myCarousel{{=value.id}}" data-slide-to="1" ></li>
							<li data-target="#myCarousel{{=value.id}}" data-slide-to="2" ></li>
							<li data-target="#myCarousel{{=value.id}}" data-slide-to="3" ></li>
						</ol>
						<!--轮播指标-->
						<!--轮播项目-->
                        
                        <div class="carousel-inner" style="height: 500px;">
                            <div class="item active" >
                                    <img src="http://127.0.0.1:8000/images/{{=it[index].images[0]}}" alt="First slide" >   
                            </div>
                            {{ for(var i=1, catlen=it[index].images.length; i<catlen; i++) { }}
                            <div class="item" >
                                    <img src="http://127.0.0.1:8000/images/{{=it[index].images[i]}}" alt="First slide" >   
                            </div>
							{{ } }}
                        </div>
                        
						<!--轮播控制器-->
						<a class="carousel-control left" href="#myCarousel{{=value.id}}" data-slide="prev">
							<span class="glyphicon glyphicon-chevron-left"></span>
						</a>
						<a class="carousel-control right" href="#myCarousel{{=value.id}}" data-slide="next">
							<span class="glyphicon glyphicon-chevron-right"></span>
						</a>
						<!--轮播控制器-->
					</div>
                {{?}}
              
                <div style="width: 100%; margin:30px auto;text-align: center;">
                    <a style="padding:8px 10px;background: coral;color: white;">SHARE</a>
                    <h3 style="font-weight: 500;"><a href="/userinfo.html?people={{=value.user_id}}">{{=value.name}}</a></h3>
                    <h3 style="font-weight: 500;">{{=value.title}}</h3>
                    <p style="color: #666666;height:80px;overflow:hidden;text-indent:40px;line-height:2">{{=value.message}}</p>
                    <p style="color: #666666;line-height: 26px;">
                            {{=value.id}}
                    </p>
                </div>
                <div style="width:100%;height:auto;">
                        <ul class="meta-list">
                            <li><a href="#"><i class="fa fa-comments-o" ></i>&nbsp; 37</a> &nbsp; <i class="flaticon-circle"></i> &nbsp; <a href="#"><i class="fa fa-heart-o" aria-hidden="true"></i>&nbsp; 20</a></li>
                            <li><a href="#"  data-toggle="modal" data-target="#xiang" value={{=value.cout}} onclick="read(this)"><i class="flaticon-substract"></i> &nbsp;— 继续阅读 — &nbsp; <i class="flaticon-substract"></i></a></li>
                            <li><a href="#"><i class="fa fa-share-alt" aria-hidden="true"></i> &nbsp;分享</a></li>
                        </ul>
                </div>
            </div>
            <div style="float:right;width:20%;height:100%;margin:auto;margin-top:50px">
                    <a href="/userinfo.html?people={{=value.user_id}}" style="color:black;text-decoration: none;"><img src="http://127.0.0.1:8000{{=value.userimage}}" style="width:100%;height:21%;border-radius:50%;"></a>
                    <h3 style="position:relative;right:-40%"><a href="/userinfo.html?people={{=value.user_id}}" style="color:black;text-decoration: none;">{{=value.name}}</a></h3>
                    <p style="width:100%;position:relative;left:0px;line-height:2;margin-top:50px;font-size:16px;color:gray">我就是我，不一样的烟火！加油，奥利给！</p>
            </div>
            </div>
            </div>

    {{~}}
</script>
<!-- 详情内容模板 -->
<script type="text/x-dot-template" id="xiang-modal">
   
    <div style="width:100%;height:100%;margin:auto;margin-top:50px">
        <a href="/userinfo.html?people={{=it.user_id}}" style="color:black;text-decoration: none;float:left;margin-left:40px"><img src="http://127.0.0.1:8000{{=it.userimage}}" style="width:100px;height:100px;border-radius:50%;"></a>
        <h3 style="margin-left:20px;float:left"><a href="/userinfo.html?people={{=it.user_id}}" style="color:black;text-decoration: none;">{{=it.name}}</a></h3>
        <p style="width:100%;line-height:2;margin-top:10px;float:left;margin-left:40px;font-size:16px;color:gray">我就是我，不一样的烟火！加油，奥利给！</p>
</div>
    <hr style="display:inline-block;margin-top:130px"/>
            <div style="width: 100%;height: 100%;margin:auto;">
            <div style="width:90%;margin:auto">
             {{? it.video}}  
             <video src="http://127.0.0.1:8000/media/{{=it.video}}" style="width: 100%;height:500px;outline:black;background:black;margin-top:50px" controls="controls"></video> 
             {{??}}   <div id="modal{{=it.id}}" class="carousel slide" style="width:60%;margin:auto">
						<!--轮播指标-->
						<ol class="carousel-indicators">
							<li data-target="#myCarousel{{=it.id}}" data-slide-to="0" class="active"></li>
							<li data-target="#myCarousel{{=it.id}}" data-slide-to="1" ></li>
							<li data-target="#myCarousel{{=it.id}}" data-slide-to="2" ></li>
							<li data-target="#myCarousel{{=it.id}}" data-slide-to="3" ></li>
						</ol>
						<!--轮播指标-->
						<!--轮播项目-->
                        
                        <div class="carousel-inner" style="height:auto;">
                            <div class="item active" >
                                    <img src="http://127.0.0.1:8000/images/{{=it.images[0]}}" alt="First slide" >   
                            </div>
                            {{ for(var i=1, catlen=it.images.length; i<catlen; i++) { }}
                            <div class="item" >
                                    <img src="http://127.0.0.1:8000/images/{{=it.images[i]}}" alt="First slide" >   
                            </div>
							{{ } }}
                        </div>
                        
						<!--轮播控制器-->
						<a class="carousel-control left" href="#modal{{=it.id}}" data-slide="prev">
							<span class="glyphicon glyphicon-chevron-left"></span>
						</a>
						<a class="carousel-control right" href="#modal{{=it.id}}" data-slide="next">
							<span class="glyphicon glyphicon-chevron-right"></span>
						</a>
						<!--轮播控制器-->
					</div>
                {{?}}
              
                <div style="width: 100%; margin:30px auto;text-align: left;">
                    <h3 style="font-weight: 500;">{{=it.title}}</h3>
                    <p style="color: #666666;line-height:2">{{=it.message}}</p>
                    <p style="color: #666666;line-height: 2px;">
                            {{=it.id}}
                    </p>
                </div>
                <div style="width:100%;height:auto;">
                        <ul class="meta-list">
                            <li><a href="#"><i class="fa fa-comments-o" ></i>&nbsp; 37</a> &nbsp; <i class="flaticon-circle"></i> &nbsp; <a href="#"><i class="fa fa-heart-o" aria-hidden="true"></i>&nbsp;点赞 20</a></li>
                            <!-- <li><a href="#"  data-toggle="modal" data-target="#xiang" value={{=it.cout}} onclick="read(this)"><i class="flaticon-substract"></i> &nbsp;— 继续阅读 — &nbsp; <i class="flaticon-substract"></i></a></li> -->
                            <li><a href="#"><i class="fa fa-share-alt" aria-hidden="true"></i> &nbsp;分享</a></li>
                        </ul>
                </div>
            </div>
            <div style="margin:30px 0"><img src="http://127.0.0.1:8000{{=it.userimage}}" style="width:50px;height:50px;float:left;margin-left:40px;border-radius:50%;" />
            <h4 style="float:left;margin:0 40px">{{=it.name}} :</h4> 这张照片拍的真好！
            <p style="margin-left:130px;color:gray">时间：{{=it.id}}</p></div>
            <hr />
            <div style="margin:30px 0"><img src="http://127.0.0.1:8000{{=it.userimage}}" style="width:50px;height:50px;float:left;margin-left:40px;border-radius:50%;" />
            <h4 style="float:left;margin:0 40px">{{=it.name}} :</h4> 这张照片拍的真棒！
            <p style="margin-left:130px;color:gray">时间：{{=it.id}}</p></div>
            <hr />
            <div style="margin-left:140px;margin-bottom:70px;height:100px">
                <input  style="width:70%;background:#8080802e;outline:none;border:none;border-radius:8px;height:50px;padding-left:20px"/><button style="margin-left:30px;padding:10px 20px">评论</button>
            </div>
            </div>
            </div>


</script>
<!-- 发布作品 -->
<script>
    var Images =[];
    var Video ="";
    $(function() {
        var img = []; //创建一个空对象用来保存传入的图片
        var vid = []; //创建一个空对象用来保存传入的视频
        var AllowImgFileSize = '1013760'; //10兆
        $("#inputs").change(function() {
            var fil = this.files;
            for(var i = 0; i < fil.length; i++) {

                    reads(fil[i]);
                    img.push(fil[i].name); //将传入的图片push到空对象中
                console.log(fil[i])
            }
            if(img.length >= 6) { //判断图片的数量，数量不能超过3张
                $('.uploadDIv').hide();
            } else {
                $('.uploadDIv').show();
            }
            Images=img;
        });
        $("#inputsVideo").change(function() {
            var fil = this.files;
            readsVideo(fil[0])
            Video=fil[0].name;
        });
        function reads(fil) {
            var reader = new FileReader();
            reader.readAsDataURL(fil);
            reader.onload = function() {
                document.getElementById("uploadBox").innerHTML += "<div class='divImg' id='uploadImg'><img src='" + reader.result + "' class='imgBiMG'></div>";
            }
            var formData = new FormData();
            formData.append('imgs', fil);
            $.ajax({
                url: 'http://127.0.0.1:8000/uploadImage?act=card',
                type: 'post',
                xhrFields:{                          //带上Cookie
                withCredentials : true
                },
                processData:false,
                contentType:false,
                data: formData,
                dataType: 'json',
                success: function (res) {
                    // 一旦设置的 dataType 选项，就不再关心 服务端 响应的 Content-Type 了
                    // 客户端会主观认为服务端返回的就是 JSON 格式的字符串
                    if(res['message']){


                    }
                }
            })
        }
        function readsVideo(fil) {
            var reader = new FileReader();
            reader.readAsDataURL(fil);
            reader.onload = function() {
                document.getElementById("uploadBox").innerHTML += "<div class='divImg' id='uploadImg'><video src='" + reader.result + "' class='imgBiMG'></video></div>";
            }
            var formData = new FormData();
            formData.append('vid', fil);
            $.ajax({
                url: 'http://127.0.0.1:8000/uploadMedia',
                type: 'post',
                xhrFields:{                          //带上Cookie
                withCredentials : true
                },
                processData:false,
                contentType:false,
                data: formData,
                dataType: 'json',
                success: function (res) {
                    // 一旦设置的 dataType 选项，就不再关心 服务端 响应的 Content-Type 了
                    // 客户端会主观认为服务端返回的就是 JSON 格式的字符串
                    if(res['message']){


                    }
                }
            })
        }
    })
    // 发布作品
    function sendWork(){
        var title = $('#title').val();
        var messages = $('#messages').val();
        var images = Images;
        var video = Video;
        $.ajax({
        url: 'http://127.0.0.1:8000/release',
        headers:{'content-type':"application/json"},
        type: 'post',
        xhrFields:{                          //带上Cookie
                withCredentials : true
        },
        data: JSON.stringify({ title:title,images:images,video:video,message:messages}),
        dataType: 'json',
        success: function (res) {
           if(res==='未登录'){
               alert("请先登录！")
           }
            if(res['message']){

               alert('发布成功！');
               window.location.reload();
            }
        }
    })
    }
    function read(that){
     
        datajson =textjson[$(that).attr("value")]
        console.log(datajson)
        data=doT.template(document.getElementById("xiang-modal").innerHTML);//生成模板方法
        document.getElementById("xiang-content").innerHTML=data(datajson);//数据渲染
    }
</script>
</html>